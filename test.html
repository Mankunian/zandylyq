<!doctype html>
<html lang="en" ng-app="app">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zandylyq</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">

    <!--uiSelect-->
    <link rel="stylesheet" href="css/ui-select/select2.css">
    <link rel="stylesheet" href="css/ui-select/selectize.default.css">
    <link rel="stylesheet" href="css/ui-select/select.min.css">
    <!--uiSelect-->

    <script src="Scripts/angular.min.js"></script>
    <script src="Scripts/ui-bootstrap.js"></script>
    <script src="controllers/index.js"></script>
    <script src="Scripts/jquery-2.2.1.js"></script>

    <script src="Scripts/angular-sanitize.js"></script>
    <script src="Scripts/angular-route.js"></script>

    <!--uiSelect-->
    <script src="Scripts/ui-select/select.min.js"></script>
    <!--uiSelect-->


    <style>

        html, body {
            height: 100%;
        }

        body {
            /*background: url(img/background.jpg);*/
            background-size: cover;
            background-repeat: no-repeat;
        }
    </style>

    <!--<script src="https://cdn.zingchart.com/zingchart.min.js"></script>-->
    <script src="Scripts/zingchart.min.js"></script>
    <style>
        .zc-ref {
            display: none;
        }

        zing-grid[loading] {
            height: 800px;
        }

        .background {
            margin: 5px;
        }
    </style>


</head>
<body ng-controller="graphCtrl">
<nav class="navbar navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <img src="img/balance.png" alt="logo" class="logo">
        <a class="navbar-brand" href="#">ZANDYLYQ</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li><a href="index.html">Проверка приговора</a></li>
            <li class="active"><a href="test.html">График</a></li>
        </ul>
        <div class="col-sm-3 col-md-3 hidden">
            <form class="navbar-form" role="search">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Поиск" name="q">
                    <div class="input-group-btn">
                        <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Настройки</a></li>
        </ul>
    </div>
</nav>

<div class="container-fluid">
    <div class="background row">
        <div class="col-sm-6" style="">
            <div id='myChart'></div>
        </div>

        <div class="col-sm-6">
            <div id='pieChart'></div>
        </div>
        <script>

            // var myApp = angular.module('app', ['ui.bootstrap', 'ngSanitize', 'ui.select', 'zingchart-angularjs']);

            angular.module("app").controller("graphCtrl", function ($scope, $http, $timeout, $uibModal, $log) {

                $scope.lineChart = function () {
                    var object = {
                        "article_id": "1880002",
                        "article24_id": "3",
                        "gender": 2,
                        "age": 27,
                        "soft": 0,
                        "heavy": 0
                    };


                    $http({
                        method: 'POST',
                        url: 'http://api.zandylyq.kz/v1/stat/vid-nakaz/',
                        data: object,
                        cache: false,
                        contentType: false,
                        async: true,
                        processData: false,
                        headers: {
                            'Access-Control-Allow-Origin': true,
                            'Content-Type': 'application/json; charset=utf-8',
                            "X-Requested-With": "XMLHttpRequest"
                        }
                    }).then(function (value) {
                        console.log(value);
                        $scope.data = value.data.result;
                        $scope.typeOfPunishment = [];
                        $scope.cntLic = [];
                        angular.forEach($scope.data, function (row, index) {
                            $scope.typeOfPunishment.push(row.VidNakaz);
                            $scope.cntLic.push(+row.cntLic)
                        });

                        $scope.cntLic.reduce(function (acc, value) {
                            return acc + value;
                        }, 0);


                        $scope.totalSum = $scope.cntLic.reduce(addSum, 0);

                        function addSum(a, b) {
                            return a + b;
                        }
                        ZC.LICENSE = ["b55b025e438fa8a98e32482b5f768ff5"];
                        zingchart.THEME = "classic";
                        var myConfig = {
                            "type": "line",
                            "background-color": "#003849",
                            "utc": true,
                            "title": {
                                "y": "7px",
                                "text": "Вид и сроки наказания",
                                "background-color": "#003849",
                                "font-size": "24px",
                                "font-color": "white",
                                "height": "25px"
                            },
                            "plotarea": {
                                "margin": "20% 8% 14% 12%",
                                "background-color": "#003849"
                            },
                            "legend": {
                                "layout": "float",
                                "background-color": "none",
                                "border-width": 0,
                                "shadow": 0,
                                "text-align": "middle",
                                "offsetY": 35,
                                "align": "center",
                                "item": {
                                    "font-color": "#f6f7f8",
                                    "font-size": "14px"
                                }
                            },
                            "scale-x": {
                                // "min-value": 1383292800000,
                                // "shadow": 0,
                                // "step": 3600000,
                                /*"values": [
                                     "штраф 200 МРА",
                                     "общ.раб.200 час.",
                                     "общ.раб.250 час.",
                                     "общ.раб.300 час.",
                                     "общ.раб.600 час.",
                                     "штраф 200 МРА",
                                     "общ.раб.200 час.",
                                     "общ.раб.250 час.",
                                     "общ.раб.300 час.",
                                     "общ.раб.600 час.",
                                     "штраф 200 МРА",
                                     "общ.раб.200 час.",
                                     "общ.раб.250 час.",
                                     "общ.раб.300 час.",
                                     "общ.раб.600 час."
                                ],*/
                                "values": $scope.typeOfPunishment,
                                "line-color": "#f6f7f8",
                                "tick": {
                                    "line-color": "#f6f7f8"
                                },
                                "guide": {
                                    "line-color": "#f6f7f8"
                                },
                                "item": {
                                    "font-color": "#f6f7f8"
                                },
                                /*"transform": {
                                    "type": "date",
                                    "all": "%D, %d %M<br />%h:%i %A",
                                    "guide": {
                                        "visible": false
                                    },
                                    "item": {
                                        "visible": false
                                    }
                                },*/
                                "label": {
                                    "visible": true
                                },
                                "minor-ticks": 0
                            },
                            "scale-y": {
                                // "values": "0:10:0",
                                "line-color": "#f6f7f8",
                                "shadow": 0,
                                "tick": {
                                    "line-color": "#f6f7f8"
                                },
                                "guide": {
                                    "line-color": "#f6f7f8",
                                    "line-style": "dashed"
                                },
                                "item": {
                                    "font-color": "#f6f7f8"
                                },
                                "label": {
                                    "text": "Всего лиц:" + $scope.totalSum,
                                    "font-color": "#f6f7f8"
                                },
                                "minor-ticks": 0,
                                "thousands-separator": ","
                            },
                            "crosshair-x": {
                                "line-color": "#f6f7f8",
                                "plot-label": {
                                    "border-radius": "5px",
                                    "border-width": "1px",
                                    "border-color": "#f6f7f8",
                                    "padding": "10px",
                                    "font-weight": "bold"
                                },
                                "scale-label": {
                                    "font-color": "#00baf0",
                                    "background-color": "#f6f7f8",
                                    "border-radius": "5px"
                                }
                            },
                            "tooltip": {
                                "visible": false
                            },
                            "plot": {
                                "tooltip-text": "%t views: %v<br>%k",
                                "shadow": 0,
                                "line-width": "3px",
                                "marker": {
                                    "type": "circle",
                                    "size": 3
                                },
                                "hover-marker": {
                                    "type": "circle",
                                    "size": 4,
                                    "border-width": "1px"
                                }
                            },
                            "series": [{
                                // "values": [15, 25, 10, 5, 38, 30, 11, 15, 20, 22, 17, 28, 39, 40, 27],
                                "values": $scope.cntLic.sort(),
                                "text": "Кол-во лиц",
                                "line-color": "#007790",
                                "legend-marker": {
                                    "type": "circle",
                                    "size": 5,
                                    "background-color": "#007790",
                                    "border-width": 1,
                                    "shadow": 0,
                                    "border-color": "#69dbf1"
                                },
                                "marker": {
                                    "background-color": "#007790",
                                    "border-width": 1,
                                    "shadow": 0,
                                    "border-color": "#69dbf1"
                                }
                            }
                            ]
                        };

                        zingchart.render({
                            id: 'myChart',
                            data: myConfig
                            // height: 500,
                            // width: 600
                        });

                    }, function (reason) {
                        console.log(reason)
                    })
                };
                $scope.lineChart();

                $scope.pieChart = function () {
                    var myConfig = {
                        type: "pie",
                        backgroundColor: "#003849",
                        // "background-color": "#003849",
                        plot: {
                            borderColor: "#fff",
                            borderWidth: 5,
                            // slice: 90,
                            valueBox: {
                                placement: 'out',
                                text: '%t\n%npv%',
                                fontFamily: "Open Sans"
                            },
                            tooltip:{
                                fontSize: '18',
                                fontFamily: "Open Sans",
                                padding: "5 10",
                                text: "%npv%"
                            },
                            animation:{
                                effect: 2,
                                method: 5,
                                speed: 500,
                                sequence: 1
                            }
                        },
                        source: {
                            text: 'gs.statcounter.com',
                            fontColor: "#8e99a9",
                            fontFamily: "Open Sans"
                        },
                        title: {
                            fontColor: "#fff",
                            text: 'Global Browser Usage',
                            align: "left",
                            offsetX: 10,
                            fontFamily: "Open Sans",
                            fontSize: 20
                        },
                        subtitle: {
                            offsetX: 10,
                            offsetY: 10,
                            fontColor: "#8e99a9",
                            fontFamily: "Open Sans",
                            fontSize: "13",
                            text: 'May 2016',
                            align: "left"
                        },
                        plotarea: {
                            // margin: "20 0 0 0"
                        },
                        series : [
                            {
                                values : [11.38],
                                text: "Internet Explorer",
                                backgroundColor: '#50ADF5'
                            },
                            {
                                values: [56.94],
                                text: "Chrome",
                                backgroundColor: '#FF7965'
                            },
                            {
                                values: [14.52],
                                text: 'Firefox',
                                backgroundColor: '#FFCB45'
                            },
                            {
                                text: 'Safari',
                                values: [9.69],
                                backgroundColor: '#6877e5'
                            },
                            {
                                text: 'Other',
                                values: [7.48],
                                backgroundColor: '#6FB07F'
                            }
                        ]
                    };

                    zingchart.render({
                        id : 'pieChart',
                        data : myConfig
                        // height: 500,
                        // width: 600
                    });
                };
                $scope.pieChart();

            });


        </script>
    </div>
</div>


<script src="js/bootstrap.min.js"></script>
</body>
</html>
